<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Fruits - 3 Niveaux</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 415px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px 20px;
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
            border-radius: 20px 20px 0 0;
        }

        .home-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .home-btn:hover {
            transform: translateY(-2px) scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 20px;
        }

        .quiz-title {
            font-size: 24px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .stage-indicator {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 15px;
            display: inline-block;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .question-card {
            background: white;
            border-radius: 18px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .question-image {
            width: 120px;
            height: 120px;
            background: #f8f9fa;
            border-radius: 15px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            border: 3px solid #e9ecef;
            overflow: hidden;
        }

        .question-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .question-text {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 25px;
        }

        .fruit-name-display {
            font-size: 32px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 25px;
            padding: 15px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 15px;
            border: 2px solid rgba(102, 126, 234, 0.2);
        }

        .audio-button {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            font-size: 32px;
            cursor: pointer;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
            transition: all 0.3s ease;
        }

        .audio-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-btn {
            background: white;
            border: 3px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .option-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .option-btn.correct {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
            border-color: #4ecdc4;
        }

        .option-btn.wrong {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border-color: #ff6b6b;
        }

        .option-btn.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        .image-option {
            width: 80px;
            height: 80px;
            background: #f8f9fa;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            border: 3px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 auto;
            overflow: hidden;
        }

        .image-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 9px;
        }

        .image-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .image-option.correct {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            border-color: #4ecdc4;
        }

        .image-option.wrong {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            border-color: #ff6b6b;
        }

        .next-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            display: none;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .next-btn.show {
            display: block;
        }

        .stage-complete {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .stage-complete.show {
            display: block;
        }

        .stage-complete h2 {
            color: #4ecdc4;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .continue-btn {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
            transition: all 0.3s ease;
        }

        .final-result {
            display: none;
            text-align: center;
        }

        .final-result.show {
            display: block;
        }

        .restart-btn {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
            transition: all 0.3s ease;
        }

        .feedback {
            padding: 15px;
            margin: 15px 0;
            border-radius: 12px;
            font-weight: 600;
            text-align: center;
            display: none;
        }

        .feedback.correct {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.1), rgba(68, 160, 141, 0.1));
            color: #4ecdc4;
            border: 2px solid rgba(78, 205, 196, 0.3);
            display: block;
        }

        .feedback.wrong {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(238, 90, 82, 0.1));
            color: #ff6b6b;
            border: 2px solid rgba(255, 107, 107, 0.3);
            display: block;
        }

        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            80% { transform: translateY(-5px); }
        }

        .bounce {
            animation: bounce 0.6s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 0.8s ease-in-out;
        }

        /* Ø¥Ø®ÙØ§Ø¡ Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØª */
        .audio-element {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ø²Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <button class="home-btn" onclick="goBack()" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©">ğŸ </button>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù„ÙƒÙˆÙŠØ² -->
        <div id="quiz-screen">
            <div class="header">
                <h1 class="quiz-title">Quiz Fruits - 3 Niveaux</h1>
                <div class="stage-indicator" id="stage-indicator">Niveau 1: Image â†’ Mot</div>
                <p class="subtitle" id="stage-description">Regardez l'image et choisissez le bon mot en franÃ§ais</p>
            </div>

            <div class="question-card">
                <!-- Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: ØµÙˆØ±Ø© â†’ ÙƒÙ„Ù…Ø© -->
                <div id="stage1-content">
                    <div class="question-image" id="question-image"></div>
                    <div class="question-text">Comment dit-on ceci en franÃ§ais ?</div>
                </div>

                <!-- Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: ÙƒÙ„Ù…Ø© â†’ ØµÙˆØ±Ø© -->
                <div id="stage2-content" style="display: none;">
                    <div class="fruit-name-display" id="fruit-name">Pomme</div>
                    <div class="question-text">Choisissez l'image qui correspond Ã  ce mot</div>
                </div>

                <!-- Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: ØµÙˆØª â†’ ØµÙˆØ±Ø© -->
                <div id="stage3-content" style="display: none;">
                    <button class="audio-button" id="audio-btn" onclick="playCurrentAudio()">ğŸ”Š</button>
                    <div class="question-text">Ã‰coutez et choisissez l'image qui correspond au son</div>
                </div>
                
                <div class="options-grid" id="options-container">
                    <!-- Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø³ØªÙÙ…Ù„Ø£ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                </div>

                <div id="feedback" class="feedback"></div>
                
                <button class="next-btn" id="next-btn" onclick="nextQuestion()">Question Suivante</button>
            </div>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø±Ø­Ù„Ø© -->
        <div id="stage-complete" class="stage-complete">
            <h2 id="stage-complete-title">Niveau 1 TerminÃ©!</h2>
            <div id="stage-message">Excellent! Passons au niveau suivant</div>
            <div style="margin-top: 30px;">
                <button class="continue-btn" onclick="nextStage()">Continuer au Niveau Suivant ğŸ¯</button>
            </div>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© -->
        <div id="final-result" class="final-result">
            <h2>Quiz Complet!</h2>
            <div id="final-message">FÃ©licitations! Vous avez terminÃ© tous les niveaux!</div>
            <div style="margin-top: 30px;">
                <button class="restart-btn" onclick="restartQuiz()">ğŸ”„ Recommencer</button>
                <button class="home-btn" onclick="goBack()" style="position: static; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 15px 30px; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: 600; margin: 10px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); transition: all 0.3s ease; width: auto; height: auto;">ğŸ  Accueil</button>
            </div>
        </div>
    </div>

    <!-- Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø®ÙÙŠØ© -->
    <div id="audio-container" class="audio-element"></div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙˆØ§ÙƒÙ‡ Ù…Ø¹ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        const fruitsData = [
            { name: "pomme", image: "pomme.jpg", french: "Pomme", audio: "pomme.mp3" },
            { name: "banane", image: "banane.jpg", french: "Banane", audio: "banane.mp3" },
            { name: "orange", image: "orange.jpg", french: "Orange", audio: "orange.mp3" },
            { name: "fraise", image: "fraise.jpg", french: "Fraise", audio: "fraise.mp3" },
            { name: "raisin", image: "raisin.jpg", french: "Raisin", audio: "raisin.mp3" },
            { name: "peche", image: "peche.jpg", french: "PÃªche", audio: "peche.mp3" },
            { name: "ananas", image: "ananas.jpg", french: "Ananas", audio: "ananas.mp3" },
            { name: "pasteque", image: "pasteque.jpg", french: "PastÃ¨que", audio: "pasteque.mp3" },
            { name: "melon", image: "melon.jpg", french: "Melon", audio: "melon.mp3" },
            { name: "abricot", image: "abricot.jpg", french: "Abricot", audio: "abricot.mp3" },
            { name: "kiwi", image: "kiwi.jpg", french: "Kiwi", audio: "kiwi.mp3" },
            { name: "poire", image: "poire.jpg", french: "Poire", audio: "poire.mp3" },
            { name: "avocat", image: "avocat.jpg", french: "Avocat", audio: "avocat.mp3" },
            { name: "framboise", image: "framboise.jpg", french: "Framboise", audio: "framboise.mp3" },
            { name: "cerise", image: "cerise.jpg", french: "Cerise", audio: "cerise.mp3" },
            { name: "kaki", image: "kaki.jpg", french: "Kaki", audio: "kaki.mp3" },
            { name: "figue", image: "figue.jpg", french: "Figue", audio: "figue.mp3" },
            { name: "citron", image: "citron.jpg", french: "Citron", audio: "citron.mp3" },
            { name: "clementine", image: "clementine.jpg", french: "ClÃ©mentine", audio: "clementine.mp3" },
            { name: "fruitdudragon", image: "dragon.jpg", french: "Fruit du dragon", audio: "dragon.mp3" },
            { name: "mangue", image: "mangue.jpg", french: "Mangue", audio: "mangue.mp3" },
            { name: "grenade", image: "grenade.jpg", french: "Grenade", audio: "grenade.mp3" },
            { name: "mure", image: "mure.jpg", french: "MÃ»re", audio: "mure.mp3" },
            { name: "pamplemousse", image: "pamplemousse.jpg", french: "Pamplemousse", audio: "pamplemousse.mp3" },
            { name: "papaye", image: "papaye.jpg", french: "Papaye", audio: "papaye.mp3" },
            { name: "prune", image: "prune.jpg", french: "Prune", audio: "prune.mp3" },
            { name: "myrtille", image: "myrtille.jpg", french: "Myrtille", audio: "myrtille.mp3" },
            { name: "noix de coco", image: "coco.jpg", french: "Noix de coco", audio: "coco.mp3" }
        ];

        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let currentStage = 1;
        let currentQuestionIndex = 0;
        let questions = [];
        let hasAnswered = false;
        let currentAudioElement = null;

        const stageInfo = {
            1: {
                title: "Niveau 1: Image â†’ Mot",
                description: "Regardez l'image et choisissez le bon mot en franÃ§ais"
            },
            2: {
                title: "Niveau 2: Mot â†’ Image", 
                description: "Lisez le mot et choisissez la bonne image"
            },
            3: {
                title: "Niveau 3: Son â†’ Image",
                description: "Ã‰coutez et choisissez l'image qui correspond au son"
            }
        };

        // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
        function goBack() {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.close();
            }
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒÙˆÙŠØ²
        function setupQuiz() {
            currentStage = 1;
            currentQuestionIndex = 0;
            hasAnswered = false;
            
            setupStage();
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        function setupStage() {
            questions = [...fruitsData];
            shuffleArray(questions);
            currentQuestionIndex = 0;
            hasAnswered = false;
            
            updateStageUI();
            
            document.getElementById('quiz-screen').style.display = 'block';
            document.getElementById('stage-complete').classList.remove('show');
            document.getElementById('final-result').classList.remove('show');
            
            showQuestion();
        }

        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø­Ù„Ø©
        function updateStageUI() {
            document.getElementById('stage-indicator').textContent = stageInfo[currentStage].title;
            document.getElementById('stage-description').textContent = stageInfo[currentStage].description;
            
            document.getElementById('stage1-content').style.display = 'none';
            document.getElementById('stage2-content').style.display = 'none';
            document.getElementById('stage3-content').style.display = 'none';
            
            document.getElementById(`stage${currentStage}-content`).style.display = 'block';
        }

        // Ø®Ù„Ø· Ø§Ù„Ù…ØµÙÙˆÙØ©
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ
        function showQuestion() {
            if (currentQuestionIndex >= questions.length) {
                showStageComplete();
                return;
            }

            const currentQuestion = questions[currentQuestionIndex];
            hasAnswered = false;
            
            if (currentStage === 1) {
                showStage1Question(currentQuestion);
            } else if (currentStage === 2) {
                showStage2Question(currentQuestion);
            } else if (currentStage === 3) {
                showStage3Question(currentQuestion);
            }
            
            document.getElementById('next-btn').classList.remove('show');
            document.getElementById('feedback').style.display = 'none';
        }

        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: ØµÙˆØ±Ø© â†’ ÙƒÙ„Ù…Ø©
        function showStage1Question(currentQuestion) {
            const imageElement = document.getElementById('question-image');
            imageElement.innerHTML = `<img src="${currentQuestion.image}" alt="${currentQuestion.french}" onerror="this.style.display='none'; this.parentElement.innerHTML='ğŸ';">`;
            
            createTextOptions(currentQuestion);
        }

        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: ÙƒÙ„Ù…Ø© â†’ ØµÙˆØ±Ø©
        function showStage2Question(currentQuestion) {
            document.getElementById('fruit-name').textContent = currentQuestion.french;
            
            createImageOptions(currentQuestion);
        }

        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: ØµÙˆØª â†’ ØµÙˆØ±Ø©
        function showStage3Question(currentQuestion) {
            window.currentAudioQuestion = currentQuestion;
            
            setTimeout(() => {
                playCurrentAudio();
            }, 500);
            
            createImageOptions(currentQuestion);
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„Ù‡Ø§ØªÙ
        function playCurrentAudio() {
            if (window.currentAudioQuestion) {
                try {
                    // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ØµÙˆØª Ø³Ø§Ø¨Ù‚
                    if (currentAudioElement) {
                        currentAudioElement.pause();
                        currentAudioElement = null;
                    }

                    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± ØµÙˆØª Ø¬Ø¯ÙŠØ¯
                    currentAudioElement = new Audio();
                    currentAudioElement.src = window.currentAudioQuestion.audio;
                    
                    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ù„Ù„Ø£Ø­Ø¯Ø§Ø«
                    currentAudioElement.addEventListener('canplaythrough', function() {
                        this.play().catch(e => {
                            console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:', e);
                            // ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø§Ù„ØµÙˆØªØŒ Ø§Ø³ØªØ®Ø¯Ù… Speech Synthesis ÙƒØ¨Ø¯ÙŠÙ„
                            fallbackToSpeechSynthesis(window.currentAudioQuestion.french);
                        });
                    });

                    currentAudioElement.addEventListener('error', function() {
                        console.log('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„ØµÙˆØªØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Speech Synthesis');
                        fallbackToSpeechSynthesis(window.currentAudioQuestion.french);
                    });

                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                    currentAudioElement.load();
                    
                    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ
                    document.getElementById('audio-btn').classList.add('pulse');
                    setTimeout(() => {
                        document.getElementById('audio-btn').classList.remove('pulse');
                    }, 800);

                } catch (error) {
                    console.log('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„ØµÙˆØª:', error);
                    fallbackToSpeechSynthesis(window.currentAudioQuestion.french);
                }
            }
        }

        // ÙˆØ¸ÙŠÙØ© Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù€ Speech Synthesis
        function fallbackToSpeechSynthesis(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'fr-FR';
                utterance.rate = 0.8;
                utterance.pitch = 1;
                speechSynthesis.speak(utterance);
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø®ÙŠØ§Ø±Ø§Øª Ù†ØµÙŠØ© (Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰)
        function createTextOptions(correctAnswer) {
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            let wrongOptions = fruitsData.filter(fruit => fruit.name !== correctAnswer.name);
            shuffleArray(wrongOptions);
            wrongOptions = wrongOptions.slice(0, 3);
            
            let allOptions = [correctAnswer, ...wrongOptions];
            shuffleArray(allOptions);
            
            allOptions.forEach((option, index) => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'option-btn';
                optionBtn.textContent = option.french;
                optionBtn.onclick = () => selectOption(optionBtn, option.name === correctAnswer.name, correctAnswer);
                optionsContainer.appendChild(optionBtn);
            });
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø®ÙŠØ§Ø±Ø§Øª ØµÙˆØ± (Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ù„Ø«Ø§Ù„Ø«Ø©)
        function createImageOptions(correctAnswer) {
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            let wrongOptions = fruitsData.filter(fruit => fruit.name !== correctAnswer.name);
            shuffleArray(wrongOptions);
            wrongOptions = wrongOptions.slice(0, 3);
            
            let allOptions = [correctAnswer, ...wrongOptions];
            shuffleArray(allOptions);
            
            allOptions.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option-btn';
                optionDiv.style.padding = '10px';
                
                const imageDiv = document.createElement('div');
                imageDiv.className = 'image-option';
                imageDiv.innerHTML = `<img src="${option.image}" alt="${option.french}" onerror="this.style.display='none'; this.parentElement.innerHTML='ğŸ';">`;
                imageDiv.onclick = () => selectImageOption(imageDiv, option.name === correctAnswer.name, correctAnswer);
                
                optionDiv.appendChild(imageDiv);
                optionsContainer.appendChild(optionDiv);
            });
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ø®ÙŠØ§Ø± Ù†ØµÙŠ
        function selectOption(button, isCorrect, correctAnswer) {
            if (hasAnswered) return;
            
            hasAnswered = true;
            const allOptions = document.querySelectorAll('.option-btn');
            
            allOptions.forEach(btn => btn.classList.add('disabled'));
            
            if (isCorrect) {
                button.classList.add('correct');
                showFeedback(true, `Correct! C'est bien "${correctAnswer.french}"`);
                button.classList.add('bounce');
                playSuccessSound(correctAnswer);
            } else {
                button.classList.add('wrong');
                allOptions.forEach(btn => {
                    if (btn.textContent === correctAnswer.french) {
                        btn.classList.add('correct');
                    }
                });
                showFeedback(false, `Incorrect! La bonne rÃ©ponse est "${correctAnswer.french}"`);
                playErrorSound(correctAnswer);
            }
            
            setTimeout(() => {
                document.getElementById('next-btn').classList.add('show');
            }, 1000);
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ø®ÙŠØ§Ø± ØµÙˆØ±Ø©
        function selectImageOption(imageElement, isCorrect, correctAnswer) {
            if (hasAnswered) return;
            
            hasAnswered = true;
            const allImages = document.querySelectorAll('.image-option');
            
            allImages.forEach(img => {
                img.style.pointerEvents = 'none';
                img.style.opacity = '0.7';
            });
            
            if (isCorrect) {
                imageElement.classList.add('correct');
                showFeedback(true, `Correct! C'est bien "${correctAnswer.french}"`);
                imageElement.classList.add('bounce');
                playSuccessSound(correctAnswer);
            } else {
                imageElement.classList.add('wrong');
                allImages.forEach(img => {
                    const imgSrc = img.querySelector('img')?.src;
                    if (imgSrc && imgSrc.includes(questions[currentQuestionIndex].image)) {
                        img.classList.add('correct');
                    }
                });
                showFeedback(false, `Incorrect! La bonne rÃ©ponse est "${correctAnswer.french}"`);
                playErrorSound(correctAnswer);
            }
            
            setTimeout(() => {
                document.getElementById('next-btn').classList.add('show');
            }, 1000);
        }

        // Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚
        function showFeedback(isCorrect, message) {
            const feedback = document.getElementById('feedback');
            feedback.textContent = message;
            feedback.className = `feedback ${isCorrect ? 'correct' : 'wrong'}`;
        }

        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
        function nextQuestion() {
            currentQuestionIndex++;
            showQuestion();
        }

        // Ø¹Ø±Ø¶ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø±Ø­Ù„Ø©
        function showStageComplete() {
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('stage-complete').classList.add('show');
            
            document.getElementById('stage-complete-title').textContent = `Niveau ${currentStage} TerminÃ©!`;
            
            let message = '';
            
            if (currentStage === 1) {
                message = 'Excellent! Passons au niveau suivant ğŸŒŸ';
            } else if (currentStage === 2) {
                message = 'Bon travail! Continuons ğŸ‘';
            } else {
                message = 'Bien essayÃ©! Le niveau suivant vous aidera ğŸ’ª';
            }
            
            if (currentStage === 3) {
                message = 'FÃ©licitations! Vous avez terminÃ© tous les niveaux!';
                document.querySelector('.continue-btn').textContent = 'Voir les RÃ©sultats Finaux ğŸ†';
            }
            
            document.getElementById('stage-message').textContent = message;
        }

        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
        function nextStage() {
            if (currentStage < 3) {
                currentStage++;
                setupStage();
            } else {
                showFinalResults();
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        function showFinalResults() {
            document.getElementById('stage-complete').classList.remove('show');
            document.getElementById('final-result').classList.add('show');
            
            document.getElementById('final-message').textContent = 'FÃ©licitations! Vous avez terminÃ© tous les niveaux! ğŸŒŸğŸ‰';
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆÙŠØ²
        function restartQuiz() {
            setupQuiz();
        }

        // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ù†Ø¬Ø§Ø­
        function playSuccessSound(correctAnswer) {
            try {
                // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ù…Ù„Ù Ø§Ù„ØµÙˆØª Ø£ÙˆÙ„Ø§Ù‹
                const successAudio = new Audio();
                successAudio.src = correctAnswer.audio;
                
                successAudio.addEventListener('canplaythrough', function() {
                    this.play().catch(e => {
                        // ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø§Ù„ØµÙˆØªØŒ Ø§Ø³ØªØ®Ø¯Ù… Speech Synthesis
                        fallbackToSpeechSynthesis(correctAnswer.french);
                    });
                });

                successAudio.addEventListener('error', function() {
                    // ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„ÙØŒ Ø§Ø³ØªØ®Ø¯Ù… Speech Synthesis
                    fallbackToSpeechSynthesis(correctAnswer.french);
                });

                successAudio.load();
            } catch (error) {
                // ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ AudioØŒ Ø§Ø³ØªØ®Ø¯Ù… Speech Synthesis
                fallbackToSpeechSynthesis(correctAnswer.french);
            }
        }

        // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø®Ø·Ø£
        function playErrorSound(correctAnswer) {
            if ('speechSynthesis' in window) {
                // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ù„Ù„ÙØ´Ù„ Ø£ÙˆÙ„Ø§Ù‹
                const failSound = new SpeechSynthesisUtterance('Oh non!');
                failSound.lang = 'fr-FR';
                failSound.rate = 0.6;
                failSound.pitch = 0.6;
                
                // Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙˆØª Ø§Ù„ÙØ´Ù„ØŒ ØªØ´ØºÙŠÙ„ Ø§Ø³Ù… Ø§Ù„ÙØ§ÙƒÙ‡Ø© Ù„Ù„ØªØµØ­ÙŠØ­
                failSound.onend = function() {
                    setTimeout(() => {
                        try {
                            // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ù…Ù„Ù Ø§Ù„ØµÙˆØª Ø£ÙˆÙ„Ø§Ù‹
                            const correctAudio = new Audio();
                            correctAudio.src = correctAnswer.audio;
                            
                            correctAudio.addEventListener('canplaythrough', function() {
                                this.play().catch(e => {
                                    fallbackToSpeechSynthesis(correctAnswer.french);
                                });
                            });

                            correctAudio.addEventListener('error', function() {
                                fallbackToSpeechSynthesis(correctAnswer.french);
                            });

                            correctAudio.load();
                        } catch (error) {
                            fallbackToSpeechSynthesis(correctAnswer.french);
                        }
                    }, 300);
                };
                
                speechSynthesis.speak(failSound);
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Speech Synthesis Ù…ØªØ§Ø­Ø§Ù‹ØŒ Ø­Ø§ÙˆÙ„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø©
                try {
                    const correctAudio = new Audio();
                    correctAudio.src = correctAnswer.audio;
                    correctAudio.play().catch(e => console.log('ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª'));
                } catch (error) {
                    console.log('ÙØ´Ù„ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª');
                }
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ÙƒÙˆÙŠØ² Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            setupQuiz();
        };

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù‚Ø± Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ
        document.addEventListener('click', function() {
            // Ù‡Ø°Ø§ ÙŠØ³Ø§Ø¹Ø¯ ÙÙŠ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø©
            if (window.AudioContext) {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            }
        }, { once: true });
    </script>
</body>
</html>